<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>CloudShell Developer Guide : Driver Deep Dive</title>
        <meta name="description" content="">
        <link rel="shortcut icon" type="image/png" href="/devguide_7/favicon.png?">
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/devguide_7/css/main.css">
        <link rel="stylesheet" href="/devguide_7/css/prism.css">
        <link rel="stylesheet" href="/devguide_7/css/samples.css">
        <link rel="stylesheet" href="/devguide_7/css/normalize.css">
        <link rel="stylesheet" href="/devguide_7/css/test-hot-block.webflow.css">


        <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
        <script src="/devguide_7/js/jquery-3.1.0.min.js"></script>
        <script src="/devguide_7/js/modernizr.js"></script>
        <script src="/devguide_7/js/webflow.js"></script>


        
        <script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

 ga('create', 'UA-81468206-1', 'auto');
 ga('send', 'pageview');

</script>

        <!-- Begin Jekyll SEO tag v2.1.0 -->
<title>Driver Deep Dive - CloudShell Developer Guide</title>
<meta property="og:title" content="Driver Deep Dive" />
<meta name="description" content="In this section we’ll take a look at some of the design principles and mechanics of Shell drivers. To get started, we should first create a Shell project to experiment with. Once again we’ll use ShellFoundry." />
<meta property="og:description" content="In this section we’ll take a look at some of the design principles and mechanics of Shell drivers. To get started, we should first create a Shell project to experiment with. Once again we’ll use ShellFoundry." />
<link rel="canonical" href="https://qualisystems.github.io/devguide_7/shells/driver-deep-dive.html" />
<meta property="og:url" content="https://qualisystems.github.io/devguide_7/shells/driver-deep-dive.html" />
<meta property="og:site_name" content="CloudShell Developer Guide" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-03-07T23:34:49+02:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@qualisystems" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "Driver Deep Dive",
"datePublished": "2017-03-07T23:34:49+02:00",
"description": "In this section we’ll take a look at some of the design principles and mechanics of Shell drivers. To get started, we should first create a Shell project to experiment with. Once again we’ll use ShellFoundry.",
"publisher": {"@type": "Organization",
"logo": {"@type": "ImageObject",
"url": "https://qualisystems.github.io/devguide_7/assets/logo.png"}},
"url": "https://qualisystems.github.io/devguide_7/shells/driver-deep-dive.html"}</script>
<!-- End Jekyll SEO tag -->

        
    </head>
    <body>
        <div id="header">
            <div class="container">
                <div class="row">
    <div class="col-md-3 col-sm-4">
        <a class="brand" href="/devguide_7/">
            <img alt="CloudShell Logo" src="/devguide_7/assets/logo.png" />
            CloudShell <small>Developer Guide</small>
        </a>
    </div>
    <div class="col-md-9 col-sm-8">
        <form class="search" action="/devguide_7/search.html">
            <input class="input" id="search-query" type="text" name="q" placeholder="Search" />
            <input class="button" type="submit" value="Search"></input>
        </form>
    </div>
</div>

            </div>
        </div>
        <div class="container">
            <div class="row">
                
                
                    <div id="navigation" class="col-md-3 col-sm-4">
                        <ul class="nav nav-list">
     
     
        <li class="nav-header"></li>
        
        
        
     
        <li class="nav-header">Introduction</li>
        
                <li data-page-id="index.md"><a href="/devguide_7/">The CloudShell DevGuide</a></li>
        
        
        
                    <li data-page-id="_introduction/setting-up-the-development-ide.md" data-order="1"><a href="/devguide_7/introduction/setting-up-the-development-ide.html">Setting up the Development Environment</a></li>
        
     
        <li class="nav-header">Extending cloudshell with shells</li>
        
        
        
                    <li data-page-id="_shells/getting-started.md" data-order="1"><a href="/devguide_7/shells/getting-started.html">Getting Started</a></li>
        
                    <li data-page-id="_shells/shell-driver-overview.md" data-order="2"><a href="/devguide_7/shells/shell-driver-overview.html">Shell Drivers Overview</a></li>
        
                    <li data-page-id="_shells/the-shell-project.md" data-order="3"><a href="/devguide_7/shells/the-shell-project.html">The Shell Project Guide</a></li>
        
                    <li data-page-id="_shells/modeling-the-shell.md" data-order="4"><a href="/devguide_7/shells/modeling-the-shell.html">Modeling the Shell</a></li>
        
                    <li data-page-id="_shells/getting-information-from-cloudshell.md" data-order="5"><a href="/devguide_7/shells/getting-information-from-cloudshell.html">Getting Information from CloudShell</a></li>
        
                    <li data-page-id="_shells/driver-deep-dive.md" data-order="6"><a href="/devguide_7/shells/driver-deep-dive.html">Driver Deep Dive</a></li>
        
                    <li data-page-id="_shells/customizing-driver-commands.md" data-order="6"><a href="/devguide_7/shells/customizing-driver-commands.html">Commands Visibility and Usability</a></li>
        
                    <li data-page-id="_shells/implementing-discovery-for-inventory-shells.md" data-order="7"><a href="/devguide_7/shells/implementing-discovery-for-inventory-shells.html">Implementing Discovery for Inventory Shells</a></li>
        
                    <li data-page-id="_shells/discovering-inventory-snmp.md" data-order="8"><a href="/devguide_7/shells/discovering-inventory-snmp.html">Discovering Inventory using SNMP</a></li>
        
                    <li data-page-id="_shells/debugging-shell-commands.md" data-order="9"><a href="/devguide_7/shells/debugging-shell-commands.html">Debugging Shell Driver Commands</a></li>
        
                    <li data-page-id="_shells/deploying-to-production.md" data-order="11"><a href="/devguide_7/shells/deploying-to-production.html">Deploying to Production</a></li>
        
                    <li data-page-id="_shells/common-driver-recipes.md" data-order="12"><a href="/devguide_7/shells/common-driver-recipes.html">Common Driver Recipes</a></li>
        
                    <li data-page-id="_shells/tips-and-tricks.md" data-order="13"><a href="/devguide_7/shells/tips-and-tricks.html">Tips and Tricks</a></li>
        
     
        <li class="nav-header">Orchestration scripts</li>
        
        
        
                    <li data-page-id="_orchestration/getting-started.md" data-order="1"><a href="/devguide_7/orchestration/getting-started.html">Getting Started</a></li>
        
                    <li data-page-id="_orchestration/getting-information-from-cloudshell.md" data-order="2"><a href="/devguide_7/orchestration/getting-information-from-cloudshell.html">Getting Information from CloudShell</a></li>
        
                    <li data-page-id="_orchestration/script-commands-customization.md" data-order="6"><a href="/devguide_7/orchestration/script-commands-customization.html">Script commands Visibility and Usability</a></li>
        
                    <li data-page-id="_orchestration/scripts-deep-dive.md" data-order="6"><a href="/devguide_7/orchestration/scripts-deep-dive.html">Scripts Deep Dive</a></li>
        
                    <li data-page-id="_orchestration/common-orchestration-recipes.md" data-order="9"><a href="/devguide_7/orchestration/common-orchestration-recipes.html">Common Orchestration Script Recipes</a></li>
        
                    <li data-page-id="_orchestration/the-oob-orchestration.md" data-order="9"><a href="/devguide_7/orchestration/the-oob-orchestration.html">CloudShell's OOB Orchestration</a></li>
        
     
        <li class="nav-header">Integrating cloudshell into the devops cycle</li>
        
        
        
                    <li data-page-id="_devops/devops-integration.md" data-order="1"><a href="/devguide_7/devops/devops-integration.html">Automating CloudShell Sandboxes for DevOps</a></li>
        
     
        <li class="nav-header">Reference</li>
        
        
        
                    <li data-page-id="_reference/python-coding-standards.md" data-order="7"><a href="/devguide_7/reference/python-coding-standards.html">Python Coding Standards</a></li>
        
     
</ul>

                    </div>

                    <div id="content" class="col-md-9 col-sm-8">
                        

<div class="page-header" data-page-id="_shells/driver-deep-dive.md">
    <h2>Driver Deep Dive
        
        
          <span style="float: right;font-size: 20px"><small><a href="https://github.com/QualiSystems/devguide_source/tree/master/_shells/driver-deep-dive.md">Suggest edits</a></small></span>
        
    </h2>
</div>

<p>In this section we’ll take a look at some of the design principles and mechanics of
Shell drivers. To get started, we should first create a Shell project to experiment with.
Once again we’ll use ShellFoundry.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">shellfoundry new driver-example --template=resource-clean
cd driver_example</code></pre></figure>

<h4 id="the-driver-structure">The driver structure</h4>

<p>The <strong><em>src</em></strong> folder in the Shell project is the driver source code root. On some IDEs
you need to set that manually when opening the Shell project.</p>

<p>Every Shell driver is required to have one main driver class. This class represents
the main driver interface and is the file CloudShell introspects to get and validate
the list of commands for the Shell. Every ShellFoundry template will generate the
driver main file in the <strong><em>driver.py</em></strong> file and a main driver class with the name
<strong><em>[ShellName]Driver</em></strong>, both of which are the convention.</p>

<p>Any public function added to this driver will be considered a Shell command. Any private function (prefixed by Python convention
by an underscore) added to the main class will be considered an internal helper function and will be ignored by CloudShell. We can
refer to these public functions in the driver class as CloudShell command functions. Each command function can also have a special
parameter called <em>context</em>. This parameter will be provided by CloudShell as an object containing information about the sandbox
and resource/app the device is executing against. Another special property of the <em>context</em> parameter is that its completely
invisible to users or API clients executing the command. If you execute the command from the UI or API you will never see a
<em>context</em> parameter. The <em>context</em> object is reviewed in the
 <a href="/devguide_7/shells/getting-information-from-cloudshell.html">Getting information from CloudShell</a> section of this guide.</p>

<p>The <strong><em>drivermetadata.xml</em></strong> file, also located in the <em>src</em> directory provides additional
information on the driver functions and how CloudShell should expose and display them as CloudShell
Commands. More information about this file and how to customize CloudShell commands can be found in the
<a href="/devguide_7/shells/customizing-driver-commands.html">Commands visibility and usability</a> section.</p>

<p>The driver can contain additional files and folders which you can reference in your driver class.
In order to reference a file in a nested folder you need to add an  <strong><em>__init__.py</em></strong> file according
to Python convention so that the folder is considered a package with its own namespace.</p>

<h4 id="referencing-other-packages">Referencing other packages</h4>

<p>A driver can also have a <strong><em>requirements.txt</em></strong> file to declare any dependencies on external packages
just like any Python package. When CloudShell creates a virtual environment to run the driver,
it will use <strong><em>pip</em></strong> to pull those requirements and prepare the environment.</p>

<p>The requirements file follows the normal pip rules
 and <a href="https://pip.pypa.io/en/stable/reference/pip_install/#requirements-file-format">file format</a>.</p>

<p>As the requirements are pulled each time a driver virtual environment is created, it is recommended to either
pin the external package version in the requirement file, or at least use semantic versioning
convention to limit the automatic updates to patch releases only. If you link to an external package by name only
and without any version constraints and a new version of the package with breaking changes is released, the
driver code may break as well. All Quali released drivers either pin the dependency version or specify
a range allowing patch version updated only. For example, if you look at the generated requirements file for
our project:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">cloudshell-shell-core&gt;=2.0.0,&lt;2.1.0</code></pre></figure>

<p>According to this constraint, pip will not automatically install any minor version beyond 2.0 but patch versions are allowed.</p>

<h4 id="returning-results">Returning Results</h4>

<p>Any result returned by the Python driver command function will be considered the command result by CloudShell.
String will be returned as is, if you return an object CloudShell will try to convert it into a string JSON.
Its not advisable to return complex objects that cannot be serialized such as sessions or connections as that would most
likely result in an error.</p>

<p>To demonstrate this, let’s add a couple of functions to the driver:</p>

<div class="github-sample-reference">
  <div class="author-info">
    <a href="https://github.com/QualiSystems/devguide_examples/blob/driver_deep_dive/adding_examples/driver_deep_dive/src/driver.py">This Github Sample</a> is by <a href="https://github.com/QualiSystems">QualiSystems</a>
  </div>
  <div class="meta-info">
    adding_examples/driver_deep_dive/src/driver.py <a href="https://github.com/QualiSystems/devguide_examples/blob/driver_deep_dive/adding_examples/driver_deep_dive/src/driver.py">view</a> <a href="https://raw.githubusercontent.com/QualiSystems/devguide_examples/driver_deep_dive/adding_examples/driver_deep_dive/src/driver.py">raw</a>
  </div>
</div>

<figure class="highlight"><pre><code class="language-python" data-lang="python">def return_simple_string(self, context):
    &quot;&quot;&quot;
    A simple example function returning a string
    :param ResourceCommandContext context: the context the command runs on
    &quot;&quot;&quot;
    return &quot;Some string return value&quot;

def return_complex_object(self, context):
    &quot;&quot;&quot;
    A simple example function returning a string
    :param ResourceCommandContext context: the context the command runs on
    &quot;&quot;&quot;
    return context</code></pre></figure>

<p>In the first example, we just return a line of string. In the second example, we actually return the context object that is
being passed to the driver.</p>

<p>After adding the functions reinstall the Shell using ShellFoundry and run the new commands:</p>

<p><img src="/devguide_7/assets/simple_string_return.png" alt="Simple String Result" /></p>

<p><img src="/devguide_7/assets/complex_object_result.png" alt="Simple String Result" /></p>

<p>Returning a result has several effects:</p>

<ul>
  <li>
    <p>The result will appear in the environment output and be linked from the commands panel (unless the command was executed with
  the no-output parameter)</p>
  </li>
  <li>
    <p>If another command or an orchestration script called this command, it will receive back the result.</p>
  </li>
  <li>
    <p>The command will appear as having completed successfully in the commands panel:</p>
  </li>
</ul>

<h4 id="handling-failure">Handling failure</h4>

<p>If the command failed you can throw an exception as you would in any Python code. The exception will be parsed
and the message property of the exception will be shown to the user.</p>

<p><img src="/devguide_7/assets/failed_command.png" alt="Command Results" /></p>

<div class="github-sample-reference">
  <div class="author-info">
    <a href="https://github.com/QualiSystems/devguide_examples/blob/driver_deep_dive/adding_examples/driver_deep_dive/src/driver.py">This Github Sample</a> is by <a href="https://github.com/QualiSystems">QualiSystems</a>
  </div>
  <div class="meta-info">
    adding_examples/driver_deep_dive/src/driver.py <a href="https://github.com/QualiSystems/devguide_examples/blob/driver_deep_dive/adding_examples/driver_deep_dive/src/driver.py">view</a> <a href="https://raw.githubusercontent.com/QualiSystems/devguide_examples/driver_deep_dive/adding_examples/driver_deep_dive/src/driver.py">raw</a>
  </div>
</div>

<figure class="highlight"><pre><code class="language-python" data-lang="python">def failed_command(self, context):
    &quot;&quot;&quot;
    A simple example function returning a string
    :param ResourceCommandContext context: the context the command runs on
    &quot;&quot;&quot;
    raise Exception(&quot;Failed to run command&quot;)</code></pre></figure>

<p>If the command is being called from an orchestration script or a different Python driver, calling a command that fails in
this way will result in an exception of type CloudShellAPIError. The error message will include the type of exception (the original
    exception raised in the code) as well as the error message.</p>

<p><img src="/devguide_7/assets/failed_api_error.png" alt="Command Results" /></p>

<h4 id="cancellation-and-termination">Cancellation and termination</h4>

<p>In CloudShell, cancellation and termination are treated very differently.</p>

<ul>
  <li>
    <p><strong>Termination</strong> is a brute force action that will terminate the driver execution. It is intended to deal with hanging or stuck
drivers. The danger with termination is that if used lightly it may cause the driver process to be killed in the middle of a critical
process, leaving the device/driver in an unexpected or unsupported state. Because termination is a last resort unsafe action,
CloudShell restricts the permissions for this action and only domain and system admins can terminate a command. Because it can have unwanted
side effects, the termination button has an exclamation mark next to it and you’ll need to confirm the action.</p>
  </li>
  <li>
    <p><strong>Cancellation</strong> is only available for driver commands implementing this capability. Cancelling a command signals it to complete
and gives it a chance to abort or rollback gracefully. Drivers should implement cancellation for commands that can
take up a long period of time.</p>
  </li>
</ul>

<p>To implement cancellation for a driver command, you first need to add a parameter to the Python function, which like the
<em>context</em> object will be passed in automatically by CloudShell. Adding the extra parameter, called <em>cancellation_context</em>
will signal to CloudShell that the command supports cancellation and the user will be able to attempt to stop it
while it is running. Next, add an entry for the command in the <em>drivermetadata.xml</em> file and add the attribute:
<strong><em>EnableCancellation=”true”</em></strong></p>

<div class="github-sample-reference">
  <div class="author-info">
    <a href="https://github.com/QualiSystems/devguide_examples/blob/driver_deep_dive/adding_examples/driver_deep_dive/src/drivermetadata.xml">This Github Sample</a> is by <a href="https://github.com/QualiSystems">QualiSystems</a>
  </div>
  <div class="meta-info">
    adding_examples/driver_deep_dive/src/drivermetadata.xml <a href="https://github.com/QualiSystems/devguide_examples/blob/driver_deep_dive/adding_examples/driver_deep_dive/src/drivermetadata.xml">view</a> <a href="https://raw.githubusercontent.com/QualiSystems/devguide_examples/driver_deep_dive/adding_examples/driver_deep_dive/src/drivermetadata.xml">raw</a>
  </div>
</div>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">&lt;Driver Description=&quot;Describe the purpose of your CloudShell shell&quot; MainClass=&quot;driver.DriverDeepDiveDriver&quot; Name=&quot;DriverDeepDiveDriver&quot; Version=&quot;1.0.0&quot;&gt;
    &lt;Layout&gt;
            &lt;Command Description=&quot;&quot;  EnableCancellation=&quot;true&quot; Name=&quot;cancellable_command&quot;  /&gt;
    &lt;/Layout&gt;
&lt;/Driver&gt;</code></pre></figure>

<p>Copy the following function to the driver to add a cancellable command:</p>

<div class="github-sample-reference">
  <div class="author-info">
    <a href="https://github.com/QualiSystems/devguide_examples/blob/driver_deep_dive/adding_examples/driver_deep_dive/src/driver.py">This Github Sample</a> is by <a href="https://github.com/QualiSystems">QualiSystems</a>
  </div>
  <div class="meta-info">
    adding_examples/driver_deep_dive/src/driver.py <a href="https://github.com/QualiSystems/devguide_examples/blob/driver_deep_dive/adding_examples/driver_deep_dive/src/driver.py">view</a> <a href="https://raw.githubusercontent.com/QualiSystems/devguide_examples/driver_deep_dive/adding_examples/driver_deep_dive/src/driver.py">raw</a>
  </div>
</div>

<figure class="highlight"><pre><code class="language-python" data-lang="python">def cancellable_command(self, context, cancellation_context):
    &quot;&quot;&quot;
    A simple example function returning a string
    :param ResourceCommandContext context: the context the command runs on
    :param CancellationContext cancellation_context: an object used to signal a request to cancel the operation
    &quot;&quot;&quot;
    counter = 0
    while counter &lt; 1000 and not cancellation_context.is_cancelled:
        counter += 1
        sleep(1)</code></pre></figure>

<p>Re-install the shell. You’ll now see the commands pane has a regular stop button (without an exclamation mark). If you click the
stop button the <em>is_cancelled</em> property on the <em>cancellation_context</em> object will be updated and the driver will get a chance to
complete its current actions and end its execution.</p>

<h4 id="drivers-and-concurrency">Drivers and concurrency</h4>

<p>CloudShell supports two modes for drivers:</p>

<ul>
  <li>
    <p>A serial mode (default) of execution in which for each app/resource driver instance CloudShell will send one command at a time.
  With this mode, you can be sure that when a command is executed no other command will run in parallel with that
  same resource/app and using that driver instance object.</p>
  </li>
  <li>
    <p>Concurrent execution - with this mode enabled, it will be up to the driver to handle any synchronization between
  parallel threads if needed. CloudShell will send commands to the driver in parallel.</p>
  </li>
</ul>

<p>The driver concurrency mode is defined in the shell datamodel. Open the <em>shell_model.xml</em> file in the <em>datamodel</em> directory.
Notice the <em>&lt;ResourceModel&gt;</em> element below. The <em>SupportsConcurrentCommands</em> will set the concurrency mode for the Shell
driver.</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">&lt;Shell&gt;
    &lt;ShellModel Family=&quot;Generic Resource&quot;&gt;
        &lt;ResourceModel Name=&quot;DriverDeepDive&quot; Description=&quot;&quot; SupportsConcurrentCommands=&quot;true&quot;&gt;</code></pre></figure>

<p>Sequential execution is the default mode mainly because it simplifies the driver. If the driver doesn’t have to worry about other things happening in parallel it can avoid adding mutex expressions or manage critical sections in the code.</p>

<p>You should decide whether to enable concurrent execution by balancing the usage requirements for the driver and the complexity of supporting concurrency.</p>

<ul>
  <li>
    <p><strong>Driver usage</strong>: Sometimes the driver commands not called very often so it is likely that staying with sequential execution will not affect the user experience or increate wait times. This is especially true if the Shell resource is used exclusively within each sandbox.
In such a scenario, it is being used by a single user at a time which may not require parallelism.</p>
  </li>
  <li>
    <p><strong>Complexity of supporting concurrency</strong>: Supporting concurrent executions can be more complex if the driver is not stateless or if the API or CLI the driver is communicating with does not itself support concurrency well or is limited to a specific number of sessions. In those situations there will be additional cost in terms of driver complexity to support concurrent execution.</p>
  </li>
</ul>

<h4 id="using-the-cloudshell-api">Using the CloudShell API</h4>

<p>In general, it is recommended to use the CloudShell API as little as possible from the driver, which is supposed to mostly
communicate with the app or device. However, there are several common use cases where drivers would use the API to update
CloudShell regarding the status of the resource or write additional messages to the console.</p>

<p>Starting a CloudShell API session requires information regarding the sandbox reservation and the server connectivity information.
All of that information is available in the <em>context</em> parameter of the command function that is being passed by CloudShell.
For more information about that object and the information it provides please see the
<a href="/devguide_7/shells/getting-information-from-cloudshell.html">Getting information from CloudShell</a> section.</p>

<p>First, as we’ll need the CloudShell API, we should add it to the <em>requirements.txt</em> file. Open the <em>requirements.txt</em> file
and add the following line:</p>

<p>cloudshell-automation-api&gt;=7.0.0.0,&lt;7.1.0.0</p>

<p>You should constrain the <em>cloudshell-automation-api</em> package based on the version of CloudShell you’re currently using. This specific package version will always be prefixed by the relevant CloudShell version it supports. This means that if you’re using 7.1, for example, the above line should read:</p>

<p>cloudshell-automation-api&gt;=7.1.0.0,&lt;7.2.0.0</p>

<p>To start a CloudShell API session, first import the <em>CloudShellAPISession</em> module, then initialize an object with the
connectivity parameters. Import the <em>CloudShellAPISession</em> module by adding the following statement to the beginning of the
<em>driver.py</em> file:</p>

<p>from cloudshell.api.cloudshell_api import CloudShellAPISession</p>

<p>To log in we don’t need a username/password, since we get a token we can use with the context object.
Copy and paste the following function:</p>

<div class="github-sample-reference">
  <div class="author-info">
    <a href="https://github.com/QualiSystems/devguide_examples/blob/master/driver_deep_dive/src/driver.py">This Github Sample</a> is by <a href="https://github.com/QualiSystems">QualiSystems</a>
  </div>
  <div class="meta-info">
    driver_deep_dive/src/driver.py <a href="https://github.com/QualiSystems/devguide_examples/blob/master/driver_deep_dive/src/driver.py">view</a> <a href="https://raw.githubusercontent.com/QualiSystems/devguide_examples/master/driver_deep_dive/src/driver.py">raw</a>
  </div>
</div>

<figure class="highlight"><pre><code class="language-python" data-lang="python">def use_cloudshell_api_session(self, context):
    &quot;&quot;&quot;
    A simple example function returning a string
    :param ResourceCommandContext context: the context the command runs on
    &quot;&quot;&quot;
    session = CloudShellAPISession(host=context.connectivity.server_address, token_id=context.connectivity.admin_auth_token,
                                   domain=context.reservation.domain)</code></pre></figure>

<p>This is pretty straightforward but can also probably get repetitive. The  the helper classes that are provided with the <em>cloudshell_shell_core</em> package are intended help get rid some of that boilerplate. The <em>CloudShellSessionContext</em> allows easily creating a session from a context object. To use the helper first import the module by adding this to the <em>driver.py</em> imports:</p>

<p>from cloudshell.shell.core.session.cloudshell_session import CloudShellSessionContext</p>

<p>Then, paste the following function:</p>

<div class="github-sample-reference">
  <div class="author-info">
    <a href="https://github.com/QualiSystems/devguide_examples/blob/master/driver_deep_dive/src/driver.py">This Github Sample</a> is by <a href="https://github.com/QualiSystems">QualiSystems</a>
  </div>
  <div class="meta-info">
    driver_deep_dive/src/driver.py <a href="https://github.com/QualiSystems/devguide_examples/blob/master/driver_deep_dive/src/driver.py">view</a> <a href="https://raw.githubusercontent.com/QualiSystems/devguide_examples/master/driver_deep_dive/src/driver.py">raw</a>
  </div>
</div>

<figure class="highlight"><pre><code class="language-python" data-lang="python">def use_cloudshell_api_session_with_helpers(self, context):
    &quot;&quot;&quot;
    A simple example function returning a string
    :param ResourceCommandContext context: the context the command runs on
    &quot;&quot;&quot;

    with CloudShellSessionContext(context) as session:
        session.WriteMessageToReservationOutput(context.reservation.reservation_id, &quot;Hello from Shell&quot;)</code></pre></figure>

<p>Now that we have a CloudShell API session, there are three main things we may want to do with it from our driver:
Decrypt a password attribute, update the resource live status or update the console widget with progress report.
You can find the code for these operations in the <a href="/devguide_7/shells/common-driver-recipes.html">Common Driver Recipes section</a> of this guide.</p>








    <div id="post-nav" class="clearfix">
        
            <a class="prev" href="/devguide_7/shells/getting-information-from-cloudshell.html">&laquo; Getting Information from CloudShell</a>
        
        
            <a class="next" href="/devguide_7/shells/customizing-driver-commands.html">Commands Visibility and Usability &raquo;</a>
        
    </div>




<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
        var disqus_identifier = '_shells/driver-deep-dive.md';
        var disqus_url = 'https://qualisystems.github.io/shells/driver-deep-dive.html';
        this.page.url = "https://qualisystems.github.io/devguide_7/shells/driver-deep-dive.html";  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = disqus_identifier; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//qualidev.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



<script src="/devguide_7/js/search.min.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript">
  $(function() {
    $('#search-query').lunrSearch({
      indexUrl  : '/devguide_7/js/index.json',           // url for the .json file containing search index data
      results   : '#search-results',          // selector for containing search results element
      template  : '#search-results-template', // selector for Mustache.js template
      titleMsg  : '',   // message attached in front of results (can be empty)
      emptyMsg  : '<p>Nothing found.</p>'     // shown message if search returns no results
    });
  });
</script>

<script>
$(function() {
    page = $(".page-header").attr("data-page-id")
    nav_item = $(".nav li[data-page-id='"+page+"']")
    if (nav_item) {
        $(".nav").find(".active").removeClass("active");
        nav_item.addClass("active");
    }
})
</script>

                    </div>
                
            </div>

            

            <div class="row">
                <div id="footer" class="col-sm-12">
                    Documentation for <a href="http://www.quali.com">CloudShell Developer Guide</a>

                </div>
            </div>
        </div>

        <script src="/devguide_7/js/prism.js"></script>

        
        <script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

 ga('create', 'UA-81468206-1', 'auto');
 ga('send', 'pageview');

</script>

        
    </body>
</html>
