<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>CloudShell Developer Guide : Discovering Inventory using SNMP</title>
        <meta name="description" content="">
        <link rel="shortcut icon" type="image/png" href="/devguide_7/favicon.png?">
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/devguide_7/css/main.css">
        <link rel="stylesheet" href="/devguide_7/css/prism.css">
        <link rel="stylesheet" href="/devguide_7/css/samples.css">
        <link rel="stylesheet" href="/devguide_7/css/normalize.css">
        <link rel="stylesheet" href="/devguide_7/css/test-hot-block.webflow.css">


        <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
        <script src="/devguide_7/js/jquery-3.1.0.min.js"></script>
        <script src="/devguide_7/js/modernizr.js"></script>
        <script src="/devguide_7/js/webflow.js"></script>


        
        <script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

 ga('create', 'UA-81468206-1', 'auto');
 ga('send', 'pageview');

</script>

        <!-- Begin Jekyll SEO tag v2.1.0 -->
<title>Discovering Inventory using SNMP - CloudShell Developer Guide</title>
<meta property="og:title" content="Discovering Inventory using SNMP" />
<meta name="description" content="A common way to query inventory resources is using SNMP. Quali has created its own SNMP package, cloudshell-snmp, which uses PySNMP under the hoods." />
<meta property="og:description" content="A common way to query inventory resources is using SNMP. Quali has created its own SNMP package, cloudshell-snmp, which uses PySNMP under the hoods." />
<link rel="canonical" href="https://qualisystems.github.io/devguide_7/shells/discovering-inventory-snmp.html" />
<meta property="og:url" content="https://qualisystems.github.io/devguide_7/shells/discovering-inventory-snmp.html" />
<meta property="og:site_name" content="CloudShell Developer Guide" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-03-07T23:34:49+02:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@qualisystems" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "Discovering Inventory using SNMP",
"datePublished": "2017-03-07T23:34:49+02:00",
"description": "A common way to query inventory resources is using SNMP. Quali has created its own SNMP package, cloudshell-snmp, which uses PySNMP under the hoods.",
"publisher": {"@type": "Organization",
"logo": {"@type": "ImageObject",
"url": "https://qualisystems.github.io/devguide_7/assets/logo.png"}},
"url": "https://qualisystems.github.io/devguide_7/shells/discovering-inventory-snmp.html"}</script>
<!-- End Jekyll SEO tag -->

        
    </head>
    <body>
        <div id="header">
            <div class="container">
                <div class="row">
    <div class="col-md-3 col-sm-4">
        <a class="brand" href="/devguide_7/">
            <img alt="CloudShell Logo" src="/devguide_7/assets/logo.png" />
            CloudShell <small>Developer Guide</small>
        </a>
    </div>
    <div class="col-md-9 col-sm-8">
        <form class="search" action="/devguide_7/search.html">
            <input class="input" id="search-query" type="text" name="q" placeholder="Search" />
            <input class="button" type="submit" value="Search"></input>
        </form>
    </div>
</div>

            </div>
        </div>
        <div class="container">
            <div class="row">
                
                
                    <div id="navigation" class="col-md-3 col-sm-4">
                        <ul class="nav nav-list">
     
     
        <li class="nav-header"></li>
        
        
        
     
        <li class="nav-header">Introduction</li>
        
                <li data-page-id="index.md"><a href="/devguide_7/">The CloudShell DevGuide</a></li>
        
        
        
                    <li data-page-id="_introduction/setting-up-the-development-ide.md" data-order="1"><a href="/devguide_7/introduction/setting-up-the-development-ide.html">Setting up the Development Environment</a></li>
        
     
        <li class="nav-header">Extending cloudshell with shells</li>
        
        
        
                    <li data-page-id="_shells/getting-started.md" data-order="1"><a href="/devguide_7/shells/getting-started.html">Getting Started</a></li>
        
                    <li data-page-id="_shells/shell-driver-overview.md" data-order="2"><a href="/devguide_7/shells/shell-driver-overview.html">Shell Drivers Overview</a></li>
        
                    <li data-page-id="_shells/the-shell-project.md" data-order="3"><a href="/devguide_7/shells/the-shell-project.html">The Shell Project Guide</a></li>
        
                    <li data-page-id="_shells/modeling-the-shell.md" data-order="4"><a href="/devguide_7/shells/modeling-the-shell.html">Modeling the Shell</a></li>
        
                    <li data-page-id="_shells/getting-information-from-cloudshell.md" data-order="5"><a href="/devguide_7/shells/getting-information-from-cloudshell.html">Getting Information from CloudShell</a></li>
        
                    <li data-page-id="_shells/driver-deep-dive.md" data-order="6"><a href="/devguide_7/shells/driver-deep-dive.html">Driver Deep Dive</a></li>
        
                    <li data-page-id="_shells/customizing-driver-commands.md" data-order="6"><a href="/devguide_7/shells/customizing-driver-commands.html">Commands Visibility and Usability</a></li>
        
                    <li data-page-id="_shells/implementing-discovery-for-inventory-shells.md" data-order="7"><a href="/devguide_7/shells/implementing-discovery-for-inventory-shells.html">Implementing Discovery for Inventory Shells</a></li>
        
                    <li data-page-id="_shells/discovering-inventory-snmp.md" data-order="8"><a href="/devguide_7/shells/discovering-inventory-snmp.html">Discovering Inventory using SNMP</a></li>
        
                    <li data-page-id="_shells/debugging-shell-commands.md" data-order="9"><a href="/devguide_7/shells/debugging-shell-commands.html">Debugging Shell Driver Commands</a></li>
        
                    <li data-page-id="_shells/deploying-to-production.md" data-order="11"><a href="/devguide_7/shells/deploying-to-production.html">Deploying to Production</a></li>
        
                    <li data-page-id="_shells/common-driver-recipes.md" data-order="12"><a href="/devguide_7/shells/common-driver-recipes.html">Common Driver Recipes</a></li>
        
                    <li data-page-id="_shells/tips-and-tricks.md" data-order="13"><a href="/devguide_7/shells/tips-and-tricks.html">Tips and Tricks</a></li>
        
     
        <li class="nav-header">Orchestration scripts</li>
        
        
        
                    <li data-page-id="_orchestration/getting-started.md" data-order="1"><a href="/devguide_7/orchestration/getting-started.html">Getting Started</a></li>
        
                    <li data-page-id="_orchestration/getting-information-from-cloudshell.md" data-order="2"><a href="/devguide_7/orchestration/getting-information-from-cloudshell.html">Getting Information from CloudShell</a></li>
        
                    <li data-page-id="_orchestration/script-commands-customization.md" data-order="6"><a href="/devguide_7/orchestration/script-commands-customization.html">Script commands Visibility and Usability</a></li>
        
                    <li data-page-id="_orchestration/scripts-deep-dive.md" data-order="6"><a href="/devguide_7/orchestration/scripts-deep-dive.html">Scripts Deep Dive</a></li>
        
                    <li data-page-id="_orchestration/common-orchestration-recipes.md" data-order="9"><a href="/devguide_7/orchestration/common-orchestration-recipes.html">Common Orchestration Script Recipes</a></li>
        
                    <li data-page-id="_orchestration/the-oob-orchestration.md" data-order="9"><a href="/devguide_7/orchestration/the-oob-orchestration.html">CloudShell's OOB Orchestration</a></li>
        
     
        <li class="nav-header">Integrating cloudshell into the devops cycle</li>
        
        
        
                    <li data-page-id="_devops/devops-integration.md" data-order="1"><a href="/devguide_7/devops/devops-integration.html">Automating CloudShell Sandboxes for DevOps</a></li>
        
     
        <li class="nav-header">Reference</li>
        
        
        
                    <li data-page-id="_reference/python-coding-standards.md" data-order="7"><a href="/devguide_7/reference/python-coding-standards.html">Python Coding Standards</a></li>
        
     
</ul>

                    </div>

                    <div id="content" class="col-md-9 col-sm-8">
                        

<div class="page-header" data-page-id="_shells/discovering-inventory-snmp.md">
    <h2>Discovering Inventory using SNMP
        
        
          <span style="float: right;font-size: 20px"><small><a href="https://github.com/QualiSystems/devguide_source/tree/master/_shells/discovering-inventory-snmp.md">Suggest edits</a></small></span>
        
    </h2>
</div>

<p>A common way to query inventory resources is using SNMP. Quali has created its own
SNMP package, <a href="https://github.com/QualiSystems/cloudshell-snmp">cloudshell-snmp</a>, which uses
<a href="http://pysnmp.sourceforge.net/">PySNMP</a> under the hoods.</p>

<p>The <a href="https://github.com/QualiSystems/cloudshell-snmp">cloudshell-snmp</a> package comes bundled
with common SNMP MIBs which are pretty generic across most devices.
You can find the full list of MIBs that are provided as a part of the cloudshell-snmp package
in the <a href="https://github.com/QualiSystems/cloudshell-snmp/tree/dev/cloudshell/snmp/mibs">package repository</a>.</p>

<p>Here’s a short explanation of the MIBs typically used in discovery:</p>

<ul>
  <li>
    <p>IF-MIB: In this MIB we are using the table called “ifTable”, which contains information about the ports like interface full address
  (e.g. GigabitEthrnet0/0/1), the type of the port, speed etc.</p>
  </li>
  <li>
    <p>Entity-MIB: Contains information about Chassis, modules, ports and describes the structure of the entities. It also contains the physical
  index of each entity, using the index we can then map between port to its associated interface.</p>
  </li>
  <li>
    <p>IP-MIB: Contains the IP (IPV6 or IPV4) address of each port.</p>
  </li>
  <li>
    <p>SNMPv2-MIB: Contains information about the serial number of the device, system description etc.</p>
  </li>
  <li>
    <p>Etherlike-Mib: Used by CloudShell Shells typically to get the duplex value of interfaces.</p>
  </li>
</ul>

<h4 id="basic-usage">Basic usage</h4>

<div class="github-sample-reference">
  <div class="author-info">
    <a href="https://github.com/QualiSystems/devguide_examples/blob/master/snmp_example/snmp_generic_discovery/snmp_basic_usage.py">This Github Sample</a> is by <a href="https://github.com/QualiSystems">QualiSystems</a>
  </div>
  <div class="meta-info">
    snmp_example/snmp_generic_discovery/snmp_basic_usage.py <a href="https://github.com/QualiSystems/devguide_examples/blob/master/snmp_example/snmp_generic_discovery/snmp_basic_usage.py">view</a> <a href="https://raw.githubusercontent.com/QualiSystems/devguide_examples/master/snmp_example/snmp_generic_discovery/snmp_basic_usage.py">raw</a>
  </div>
</div>

<figure class="highlight"><pre><code class="language-python" data-lang="python">def retrieving_snmp_properties(self, ip, community_string):

    logger = get_qs_logger()

    snmp_service = QualiSnmp(ip=ip, snmp_version=&#39;2&#39;,
                          snmp_community=community_string,
                          logger=logger)

    return snmp_service.get_property(&#39;SNMPv2-MIB&#39;, &#39;sysName&#39;, 0)</code></pre></figure>

<p>In the above example, we initialize the QualiSnmp module which requires at least the device IP and the community string.
We then use the <em>get_property</em> function to get the value of the <em>sysName</em> property using one of the MIBs which are included
with cloudshell-snmp.</p>

<div class="github-sample-reference">
  <div class="author-info">
    <a href="https://github.com/QualiSystems/devguide_examples/blob/master/snmp_example/snmp_generic_discovery/snmp_basic_usage.py">This Github Sample</a> is by <a href="https://github.com/QualiSystems">QualiSystems</a>
  </div>
  <div class="meta-info">
    snmp_example/snmp_generic_discovery/snmp_basic_usage.py <a href="https://github.com/QualiSystems/devguide_examples/blob/master/snmp_example/snmp_generic_discovery/snmp_basic_usage.py">view</a> <a href="https://raw.githubusercontent.com/QualiSystems/devguide_examples/master/snmp_example/snmp_generic_discovery/snmp_basic_usage.py">raw</a>
  </div>
</div>

<figure class="highlight"><pre><code class="language-python" data-lang="python">def retrieving_snmp_table(self, ip):
    logger = get_qs_logger()

    snmp_service = QualiSnmp(ip=ip, snmp_version=&#39;2&#39;,
                             snmp_community=&quot;Community String&quot;,
                             logger=logger)

    if_table = snmp_service.get_table(&#39;IF-MIB&#39;, &#39;ifDescr&#39;)</code></pre></figure>

<p>Here we used the same class to retrieve the entire IF table. The <em>get_table</em> function returns a Quali object which
inherits from Python’s <em>ordered_dictionary</em> with additional handy sorting and filtering functions to get the table’s
rows and columns.</p>

<p>Since the SNMP parameters are included as attributes in the <a href="https://github.com/QualiSystems/cloudshell-standards/blob/master/Documentation/shell_resource_standard.md">Resource Standard</a>
they can be easily retrieved by the driver when implementing the <em>get_inventory</em> function:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">def get_inventory(self, context):
    snmp_version = context.resource.attributes[&#39;SNMP Version&#39;]
    community_string = context.resource.attributes[&#39;SNMP Read Community&#39;]</code></pre></figure>

<h4 id="supporting-custom-vendor-mibs">Supporting custom vendor MIBs</h4>

<h5 id="compiling-and-downloading-the-vendor-mibs">Compiling and downloading the vendor MIBs</h5>

<p>Some vendors will use their own custom MIBs which you’ll want to include in the discovery. For example, this  CISCO site provides access to some common
MIBS you can download: http://tools.cisco.com/ITDIT/MIBS/MainServlet?ReleaseSel=3&amp;PlatformSel=236&amp;fsSel=368. Other vendors have their own MIBs download links.</p>

<p>To compile the MIBs we recommend using the <a href="https://github.com/etingof/pysmi/blob/master/scripts/mibdump.py">mibdump.py</a> script which is part of the <a href="http://pysmi.sourceforge.net">PySMI</a> SNMP libraries and tools. The <em>mibdump.py</em> script supports both compiling MIB sources you’ve downloaded locally as well as using remote MIB sources. For example, the <a href="http://mibs.snmplabs.com/asn1/">snmplabs</a> repository provides a wealth of publicly available MIBs. Notice, if you are trying to compile MIB sources you’ve downloaded locally, you should be sure to download all of the dependencies to the same folder (e.g. IF-MIB depends on SNMPV2-MIB). However, you can specify more than one MIB source, so you can include both your local MIB sources and remote repositories.</p>

<p>The following example will compile the IF-MIB source from the <em>snmplabs</em> repository:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">python mibdump.py --mib-source=http://mibs.snmplabs.com/asn1/@mib@ IF-MIB</code></pre></figure>

<p>If you’re a Linux user, you can take advantage of the <a href="http://linux.die.net/man/1/smidump">smidump package</a>.
This package is available as an RPM/APT package for various Linux distros.
The <em>smidump</em> package is somewhat easier to use with a clear syntax. For example, to use the <em>smidump</em> package to compile the IF-MIB to Python, simply run these two lines from the terminal:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">smidump -f smiv2 -k IF-MIB.mib  &gt; if-mib.txt
smidump -f python -k if-mib.txt | libsmi2pysnmp &gt; if-mib.py</code></pre></figure>

<h5 id="including-the-compiled-mibs-in-your-shell-project">Including the compiled MIBs in your Shell project</h5>

<p>After downloading the MIB files using either the Linux or Windows option, you’ll need to include them in your shell driver project, save the MIBs Python files in a sub-package folder and add the following code to your Shell:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">snmp_service = QualiSnmp(ip=ip, snmp_version=snmp_params.snmp_version,
                         snmp_community=snmp_params.snmp_read_community,
                         logger=logger)
snmp_service.load_mib(&#39;IF-MIB&#39;)</code></pre></figure>

<p>After loading the MIB, you’ll be able to use it like any of the MIBs included in cloudshell-snmp and retrieve properties and tables.</p>

<h4 id="converting-the-mib-data-to-get_inventory-results">Converting the MIB data to get_inventory results</h4>

<p>In order to successfully load the internal structure and attributes of a resource, the <em>get_inventory</em>
function need to return lists of <em>AutoLoadResource</em> and <em>AutoLoadAttribute</em> objects.</p>

<p>The following driver implements basic discovery using generic MIBs only and converts the result to
the objects required by <em>get_inventory</em>. To view the full source click the ‘view’ or ‘raw’ links above the code snippet. The code can be used as a reference for creating similar procedures:</p>

<div class="github-sample-reference">
  <div class="author-info">
    <a href="https://github.com/QualiSystems/devguide_examples/blob/master/snmp_example/snmp_generic_discovery/generic_snmp_discovery.py">This Github Sample</a> is by <a href="https://github.com/QualiSystems">QualiSystems</a>
  </div>
  <div class="meta-info">
    snmp_example/snmp_generic_discovery/generic_snmp_discovery.py <a href="https://github.com/QualiSystems/devguide_examples/blob/master/snmp_example/snmp_generic_discovery/generic_snmp_discovery.py">view</a> <a href="https://raw.githubusercontent.com/QualiSystems/devguide_examples/master/snmp_example/snmp_generic_discovery/generic_snmp_discovery.py">raw</a>
  </div>
</div>

<figure class="highlight"><pre><code class="language-python" data-lang="python">def __init__(self, snmp_version, snmp_read_community,
                 snmp_v3_user = None,
                 snmp_v3_password = None,
                 snmp_v3_privatekey=None):

        self.snmp_version = snmp_version
        self.snmp_read_community=snmp_read_community
        self.snmp_v3_user=snmp_v3_user
        self.snmp_v3_password=snmp_v3_password
        self.snmp_v3_privatekey=snmp_v3_privatekey


class GenericSNMPDiscovery:

    def discover(self, ip, model, vendor, snmp_params):
        &quot;&quot;&quot;
        :param str ip: The device IP address
        :param str model: The device model in CloudShell
        :param str vendor: The device vendor
        :param SNMPParams snmp_params: The device vendor
        :return: The loaded resources and attributes
        :rtype: AutoLoadDetails
        &quot;&quot;&quot;

        logger = get_qs_logger()

        self.snmp = QualiSnmp(ip=ip, snmp_version=snmp_params.snmp_version,
                              snmp_user=snmp_params.snmp_v3_user,
                              snmp_password=snmp_params.snmp_v3_password,
                              snmp_community=snmp_params.snmp_read_community,</code></pre></figure>

<p>To use this module, simply initialize an instance of <em>GenericSNMPDiscovery</em> and call the <em>discover</em> method:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python">def get_inventory(self, context):
   snmp_version = context.resource.attributes[&#39;SNMP Version&#39;]
   community_string = context.resource.attributes[&#39;SNMP Read Community&#39;]
   snmp_params = SNMPParams(snmp_version=snmp_version,snmp_read_community=snmp_community)
   GenericSNMPDiscovery().discover(device_ip,&quot;Cisco 5k Switch&quot;, &quot;Cisco&quot;,snmp_params )</code></pre></figure>









    <div id="post-nav" class="clearfix">
        
            <a class="prev" href="/devguide_7/shells/implementing-discovery-for-inventory-shells.html">&laquo; Implementing Discovery for Inventory Shells</a>
        
        
            <a class="next" href="/devguide_7/shells/debugging-shell-commands.html">Debugging Shell Driver Commands &raquo;</a>
        
    </div>




<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
        var disqus_identifier = '_shells/discovering-inventory-snmp.md';
        var disqus_url = 'https://qualisystems.github.io/shells/discovering-inventory-snmp.html';
        this.page.url = "https://qualisystems.github.io/devguide_7/shells/discovering-inventory-snmp.html";  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = disqus_identifier; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//qualidev.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



<script src="/devguide_7/js/search.min.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript">
  $(function() {
    $('#search-query').lunrSearch({
      indexUrl  : '/devguide_7/js/index.json',           // url for the .json file containing search index data
      results   : '#search-results',          // selector for containing search results element
      template  : '#search-results-template', // selector for Mustache.js template
      titleMsg  : '',   // message attached in front of results (can be empty)
      emptyMsg  : '<p>Nothing found.</p>'     // shown message if search returns no results
    });
  });
</script>

<script>
$(function() {
    page = $(".page-header").attr("data-page-id")
    nav_item = $(".nav li[data-page-id='"+page+"']")
    if (nav_item) {
        $(".nav").find(".active").removeClass("active");
        nav_item.addClass("active");
    }
})
</script>

                    </div>
                
            </div>

            

            <div class="row">
                <div id="footer" class="col-sm-12">
                    Documentation for <a href="http://www.quali.com">CloudShell Developer Guide</a>

                </div>
            </div>
        </div>

        <script src="/devguide_7/js/prism.js"></script>

        
        <script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

 ga('create', 'UA-81468206-1', 'auto');
 ga('send', 'pageview');

</script>

        
    </body>
</html>
