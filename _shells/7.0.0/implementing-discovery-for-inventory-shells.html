<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>CloudShell Developer Guide : Implementing Discovery for Inventory Shells</title>
        <meta name="description" content="">
        <link rel="shortcut icon" type="image/png" href="/devguide_7/favicon.png?">
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/devguide_7/css/main.css">
        <link rel="stylesheet" href="/devguide_7/css/prism.css">
        <link rel="stylesheet" href="/devguide_7/css/samples.css">
        <link rel="stylesheet" href="/devguide_7/css/normalize.css">
        <link rel="stylesheet" href="/devguide_7/css/test-hot-block.webflow.css">


        <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet">
        <script src="/devguide_7/js/jquery-3.1.0.min.js"></script>
        <script src="/devguide_7/js/modernizr.js"></script>
        <script src="/devguide_7/js/webflow.js"></script>


        
        <script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

 ga('create', 'UA-81468206-1', 'auto');
 ga('send', 'pageview');

</script>

        <!-- Begin Jekyll SEO tag v2.1.0 -->
<title>Implementing Discovery for Inventory Shells - CloudShell Developer Guide</title>
<meta property="og:title" content="Implementing Discovery for Inventory Shells" />
<meta name="description" content="Automated discovery makes it easy to import physical inventory devices into CloudShell by using automation to read their internal structure and attributes." />
<meta property="og:description" content="Automated discovery makes it easy to import physical inventory devices into CloudShell by using automation to read their internal structure and attributes." />
<link rel="canonical" href="https://qualisystems.github.io/devguide_7/shells/implementing-discovery-for-inventory-shells.html" />
<meta property="og:url" content="https://qualisystems.github.io/devguide_7/shells/implementing-discovery-for-inventory-shells.html" />
<meta property="og:site_name" content="CloudShell Developer Guide" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2017-03-07T23:34:49+02:00" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@qualisystems" />
<script type="application/ld+json">
{"@context": "http://schema.org",
"@type": "BlogPosting",
"headline": "Implementing Discovery for Inventory Shells",
"datePublished": "2017-03-07T23:34:49+02:00",
"description": "Automated discovery makes it easy to import physical inventory devices into CloudShell by using automation to read their internal structure and attributes.",
"publisher": {"@type": "Organization",
"logo": {"@type": "ImageObject",
"url": "https://qualisystems.github.io/devguide_7/assets/logo.png"}},
"url": "https://qualisystems.github.io/devguide_7/shells/implementing-discovery-for-inventory-shells.html"}</script>
<!-- End Jekyll SEO tag -->

        
    </head>
    <body>
        <div id="header">
            <div class="container">
                <div class="row">
    <div class="col-md-3 col-sm-4">
        <a class="brand" href="/devguide_7/">
            <img alt="CloudShell Logo" src="/devguide_7/assets/logo.png" />
            CloudShell <small>Developer Guide</small>
        </a>
    </div>
    <div class="col-md-9 col-sm-8">
        <form class="search" action="/devguide_7/search.html">
            <input class="input" id="search-query" type="text" name="q" placeholder="Search" />
            <input class="button" type="submit" value="Search"></input>
        </form>
    </div>
</div>

            </div>
        </div>
        <div class="container">
            <div class="row">
                
                
                    <div id="navigation" class="col-md-3 col-sm-4">
                        <ul class="nav nav-list">
     
     
        <li class="nav-header"></li>
        
        
        
     
        <li class="nav-header">Introduction</li>
        
                <li data-page-id="index.md"><a href="/devguide_7/">The CloudShell DevGuide</a></li>
        
        
        
                    <li data-page-id="_introduction/setting-up-the-development-ide.md" data-order="1"><a href="/devguide_7/introduction/setting-up-the-development-ide.html">Setting up the Development Environment</a></li>
        
     
        <li class="nav-header">Extending cloudshell with shells</li>
        
        
        
                    <li data-page-id="_shells/getting-started.md" data-order="1"><a href="/devguide_7/shells/getting-started.html">Getting Started</a></li>
        
                    <li data-page-id="_shells/shell-driver-overview.md" data-order="2"><a href="/devguide_7/shells/shell-driver-overview.html">Shell Drivers Overview</a></li>
        
                    <li data-page-id="_shells/the-shell-project.md" data-order="3"><a href="/devguide_7/shells/the-shell-project.html">The Shell Project Guide</a></li>
        
                    <li data-page-id="_shells/modeling-the-shell.md" data-order="4"><a href="/devguide_7/shells/modeling-the-shell.html">Modeling the Shell</a></li>
        
                    <li data-page-id="_shells/getting-information-from-cloudshell.md" data-order="5"><a href="/devguide_7/shells/getting-information-from-cloudshell.html">Getting Information from CloudShell</a></li>
        
                    <li data-page-id="_shells/driver-deep-dive.md" data-order="6"><a href="/devguide_7/shells/driver-deep-dive.html">Driver Deep Dive</a></li>
        
                    <li data-page-id="_shells/customizing-driver-commands.md" data-order="6"><a href="/devguide_7/shells/customizing-driver-commands.html">Commands Visibility and Usability</a></li>
        
                    <li data-page-id="_shells/implementing-discovery-for-inventory-shells.md" data-order="7"><a href="/devguide_7/shells/implementing-discovery-for-inventory-shells.html">Implementing Discovery for Inventory Shells</a></li>
        
                    <li data-page-id="_shells/discovering-inventory-snmp.md" data-order="8"><a href="/devguide_7/shells/discovering-inventory-snmp.html">Discovering Inventory using SNMP</a></li>
        
                    <li data-page-id="_shells/debugging-shell-commands.md" data-order="9"><a href="/devguide_7/shells/debugging-shell-commands.html">Debugging Shell Driver Commands</a></li>
        
                    <li data-page-id="_shells/deploying-to-production.md" data-order="11"><a href="/devguide_7/shells/deploying-to-production.html">Deploying to Production</a></li>
        
                    <li data-page-id="_shells/common-driver-recipes.md" data-order="12"><a href="/devguide_7/shells/common-driver-recipes.html">Common Driver Recipes</a></li>
        
                    <li data-page-id="_shells/tips-and-tricks.md" data-order="13"><a href="/devguide_7/shells/tips-and-tricks.html">Tips and Tricks</a></li>
        
     
        <li class="nav-header">Orchestration scripts</li>
        
        
        
                    <li data-page-id="_orchestration/getting-started.md" data-order="1"><a href="/devguide_7/orchestration/getting-started.html">Getting Started</a></li>
        
                    <li data-page-id="_orchestration/getting-information-from-cloudshell.md" data-order="2"><a href="/devguide_7/orchestration/getting-information-from-cloudshell.html">Getting Information from CloudShell</a></li>
        
                    <li data-page-id="_orchestration/script-commands-customization.md" data-order="6"><a href="/devguide_7/orchestration/script-commands-customization.html">Script commands Visibility and Usability</a></li>
        
                    <li data-page-id="_orchestration/scripts-deep-dive.md" data-order="6"><a href="/devguide_7/orchestration/scripts-deep-dive.html">Scripts Deep Dive</a></li>
        
                    <li data-page-id="_orchestration/common-orchestration-recipes.md" data-order="9"><a href="/devguide_7/orchestration/common-orchestration-recipes.html">Common Orchestration Script Recipes</a></li>
        
                    <li data-page-id="_orchestration/the-oob-orchestration.md" data-order="9"><a href="/devguide_7/orchestration/the-oob-orchestration.html">CloudShell's OOB Orchestration</a></li>
        
     
        <li class="nav-header">Integrating cloudshell into the devops cycle</li>
        
        
        
                    <li data-page-id="_devops/devops-integration.md" data-order="1"><a href="/devguide_7/devops/devops-integration.html">Automating CloudShell Sandboxes for DevOps</a></li>
        
     
        <li class="nav-header">Reference</li>
        
        
        
                    <li data-page-id="_reference/python-coding-standards.md" data-order="7"><a href="/devguide_7/reference/python-coding-standards.html">Python Coding Standards</a></li>
        
     
</ul>

                    </div>

                    <div id="content" class="col-md-9 col-sm-8">
                        

<div class="page-header" data-page-id="_shells/implementing-discovery-for-inventory-shells.md">
    <h2>Implementing Discovery for Inventory Shells
        
        
          <span style="float: right;font-size: 20px"><small><a href="https://github.com/QualiSystems/devguide_source/tree/master/_shells/implementing-discovery-for-inventory-shells.md">Suggest edits</a></small></span>
        
    </h2>
</div>

<p>Automated discovery makes it easy to import physical inventory devices into CloudShell
by using automation to read their internal structure and attributes.</p>

<h4 id="shell-sub-resources">Shell sub-resources</h4>

<p>Physical resources Shells are defined with a certain internal structure which can be
found in their CloudShell Standard. A basic physical resource can have <em>Resource Port</em> sub-resources,
for example, whereas a <em>Switch</em> can have blades and port channels according to the
<a href="https://github.com/QualiSystems/cloudshell-standards/blob/master/Documentation/networking_standard.md">Networking Shell Standard</a>.</p>

<p>In the context of this example, we’ll create a new Switch type device based on the
<a href="https://github.com/QualiSystems/cloudshell-standards/blob/master/Documentation/networking_standard.md">Networking Shell Standard</a>.
Run the following command to create a new Shell project:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">shellfoundry new implementing-discovery --template=networking/switch
cd implementing_discovery</code></pre></figure>

<h4 id="resource-templates-and-discovery">Resource templates and discovery</h4>

<p>Auto-discovery can be automatically triggered when adding resources for Shells that support it.
To do that, you can take advantage of the <em>Shell resource templates</em> feature. This feature provides
a template for creating instances of resources for that Shell from the Inventory page of the CloudShell
portal. When the administrator creates a resource this way, he is first prompted to fill out any mandatory
attributes defined in the template, and then the discovery process is launched automatically.</p>

<p>A <em>resource_template</em> has been generated automatically as a part of the ShellFoundry template.
The <em>shellconfig.xml</em> file located in the <em>datamodel</em> directory has the following content:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;ShellsConfiguration xmlns:xsd=&quot;http://www.w3.org/2001/XMLSchema&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns=&quot;http://schemas.qualisystems.com/ResourceManagement/ShellsConfigurationSchema.xsd&quot;&gt;
&lt;ResourceTemplates&gt;
    &lt;ResourceTemplate Name=&quot;ImplementingDiscovery&quot; Model=&quot;ImplementingDiscovery&quot; Driver=&quot;ImplementingDiscoveryDriver&quot;&gt;
        &lt;Description&gt;&lt;/Description&gt;
        &lt;AutoLoad Enable=&quot;false&quot;&gt;
            &lt;Description&gt;Description for autoload &lt;/Description&gt;
        &lt;/AutoLoad&gt;
        &lt;Attributes&gt;
            &lt;Attribute Name=&quot;User&quot; Value=&quot;&quot; /&gt;
            &lt;Attribute Name=&quot;Password&quot; Value=&quot;&quot; /&gt;
        &lt;/Attributes&gt;
    &lt;/ResourceTemplate&gt;    
&lt;/ResourceTemplates&gt;
&lt;/ShellsConfiguration&gt;</code></pre></figure>

<p>As you can see, it currently defines two attributes as mandatory for the user to supply when creating a Shell resource.
This means that when the discovery process will run it can count on that information already being available and can use the supplied credentials
to login to the device. You can add additional attributes by adding additional <em>&lt;Attribute&gt;</em> elements under
the <em>&lt;Attributes&gt;</em> element.</p>

<p>For this example, we’d like discovery to also be triggered automatically when adding new resources from the Inventory Dashboard. To change that,
set <em>&lt;AutoLoad Enable=<strong>“true”</strong>&gt;</em> in the XML and save the changes.</p>

<h4 id="implementing-the-get_inventory-function">Implementing the get_inventory function</h4>

<p>The goal of the <em>get_inventory</em> function is to query the device and return a list of sub-resources
and attribute values back to CloudShell.</p>

<p>After querying the device, the function should return a specific result to CloudShell to allow
creating the right resources.</p>

<p>Add the following code to the driver:</p>

<div class="github-sample-reference">
  <div class="author-info">
    <a href="https://github.com/QualiSystems/devguide_examples/blob/driver_deep_dive/adding_examples/implementing_discovery/src/driver.py">This Github Sample</a> is by <a href="https://github.com/QualiSystems">QualiSystems</a>
  </div>
  <div class="meta-info">
    adding_examples/implementing_discovery/src/driver.py <a href="https://github.com/QualiSystems/devguide_examples/blob/driver_deep_dive/adding_examples/implementing_discovery/src/driver.py">view</a> <a href="https://raw.githubusercontent.com/QualiSystems/devguide_examples/driver_deep_dive/adding_examples/implementing_discovery/src/driver.py">raw</a>
  </div>
</div>

<figure class="highlight"><pre><code class="language-python" data-lang="python"># which includes details about the resource hierarchy and attributes
def get_inventory(self, context):
    &quot;&quot;&quot;
    :type context: AutoLoadCommandContext
    &quot;&quot;&quot;
    # Add sub resources details
    sub_resources = [ AutoLoadResource(model =&#39;Generic Chassis&#39;,name= &#39;Chassis 1&#39;, relative_address=&#39;1&#39;),
      AutoLoadResource(model=&#39;Generic Module&#39;,name= &#39;Module 1&#39;,relative_address= &#39;1/1&#39;),
      AutoLoadResource(model=&#39;Generic Port&#39;,name= &#39;Port 1&#39;, relative_address=&#39;1/1/1&#39;),
      AutoLoadResource(model=&#39;Generic Port&#39;, name=&#39;Port 2&#39;, relative_address=&#39;1/1/2&#39;),
      AutoLoadResource(model=&#39;Generic Power Port&#39;, name=&#39;Power Port&#39;, relative_address=&#39;1/PP1&#39;)]</code></pre></figure>

<p>As you can see, the <em>get_inventory</em> code creates a list of <em>AutoLoadResource</em> objects which are the sub-resources to be
imported/synched with CloudShell. Each <em>AutoLoadResource</em> object needs to be initialized with three parameters:</p>

<ul>
  <li>The <em>name</em> of the resources</li>
  <li>The <em>model</em> of the resource according to the standard. The <a href="https://github.com/QualiSystems/cloudshell-standards/blob/master/Documentation/networking_standard.md">Networking Shell Standard</a>
defines a list of possible models, among them the ones used in this example.</li>
  <li>The <em>relative_address</em> of the resource. This field is also used to derive the hierarchy of the sub-resources. As you can
see in the above example, ‘Chassis 1’ has the address “1” whereas the resource ‘Generic Module’ has the address of ‘1/1’ which
is all we need to do to indicate the module is nested under the chassis in the resource structure.</li>
</ul>

<p>Notice that we’re only returning information about sub-resources. The root resource at this stage already exists, with the
mandatory attributes defined by the template already assigned to it.</p>

<h4 id="adding-attribute-information">Adding attribute information</h4>

<p>So far we’ve seen how to return information about sub-resources. We also may want to populate some of the resource attributes
at this point with values we’ve loaded from the device. We can update both the root resource and the sub-resources attributes,
again referencing them by their addresses which we’ve provided previously.</p>

<p>After populating the attributes information, we need to return the result object with both sub-resources and attributes:</p>

<div class="github-sample-reference">
  <div class="author-info">
    <a href="https://github.com/QualiSystems/devguide_examples/blob/driver_deep_dive/adding_examples/implementing_discovery/src/driver.py">This Github Sample</a> is by <a href="https://github.com/QualiSystems">QualiSystems</a>
  </div>
  <div class="meta-info">
    adding_examples/implementing_discovery/src/driver.py <a href="https://github.com/QualiSystems/devguide_examples/blob/driver_deep_dive/adding_examples/implementing_discovery/src/driver.py">view</a> <a href="https://raw.githubusercontent.com/QualiSystems/devguide_examples/driver_deep_dive/adding_examples/implementing_discovery/src/driver.py">raw</a>
  </div>
</div>

<figure class="highlight"><pre><code class="language-python" data-lang="python">AutoLoadAttribute(&#39;&#39;, &#39;Model&#39;, &#39;Catalyst 3850&#39;),
               AutoLoadAttribute(&#39;&#39;, &#39;Vendor&#39;, &#39;Cisco&#39;),
               AutoLoadAttribute(&#39;1&#39;, &#39;Serial Number&#39;, &#39;JAE053002JD&#39;),
               AutoLoadAttribute(&#39;1&#39;, &#39;Model&#39;, &#39;WS-X4232-GB-RJ&#39;),
               AutoLoadAttribute(&#39;1/1&#39;, &#39;Model&#39;, &#39;WS-X4233-GB-EJ&#39;),
               AutoLoadAttribute(&#39;1/1&#39;, &#39;Serial Number&#39;, &#39;RVE056702UD&#39;),
               AutoLoadAttribute(&#39;1/1/1&#39;, &#39;MAC Address&#39;, &#39;fe80::e10c:f055:f7f1:bb7t16&#39;),
               AutoLoadAttribute(&#39;1/1/1&#39;, &#39;IPv4 Address&#39;, &#39;192.168.10.7&#39;),
               AutoLoadAttribute(&#39;1/1/2&#39;, &#39;MAC Address&#39;, &#39;te67::e40c:g755:f55y:gh7w36&#39;),
               AutoLoadAttribute(&#39;1/1/2&#39;, &#39;IPv4 Address&#39;, &#39;192.168.10.9&#39;),
               AutoLoadAttribute(&#39;1/PP1&#39;, &#39;Model&#39;, &#39;WS-X4232-GB-RJ&#39;),
               AutoLoadAttribute(&#39;1/PP1&#39;, &#39;Port Description&#39;, &#39;Power&#39;),
               AutoLoadAttribute(&#39;1/PP1&#39;, &#39;Serial Number&#39;, &#39;RVE056702UD&#39;)]

result = AutoLoadDetails(sub_resources,attributes)

return result</code></pre></figure>

<p>Notice that we’re using an empty string (‘’) to refer to the root resource when setting its attribute values.</p>

<h4 id="adding-validations">Adding validations</h4>

<p>A common enhancement for discovery functions that greatly improves the process usability is to validate that the attributes
the user provided are correct. For example, trying to log in with the address and credentials and reporting back any error,
or validating the that text doesn’t contain illegal characters.</p>

<p>Any exceptions you raise in the get_inventory flow will pop up the error message to the user so he/she can correct
their input and try again.</p>

<h4 id="create-a-resource-with-the-template">Create a resource with the template</h4>

<p>To test our code, first install the Shell using ShellFoundry.
Next, go to the inventory page and click on the “Create New” button. A dialog will appear where you’ll be asked
to select the template you wish to use and choose a resource name. Select the “ImplementingDiscovery” template, enter
a name for the resource and click create.</p>

<p>The following dialog will pop up:</p>

<p><img src="/devguide_7/assets/discovery_page.png" alt="Discovery Dialog" class="img-responsive" /></p>

<p>Enter some values for the Username/Password attributes and click start discovery. This will run the <em>get_inventory</em> function
we’ve created and if everything works correctly create the entire device structure and a message should pop up indicating
the discovery processes completed successfully.</p>

<p>To validate, enter the name of the new resource in the inventory search box. You should see a list of sub-resources with the
discovered attributes:</p>

<p><img src="/devguide_7/assets/inventory_search.png" alt="Discovery Dialog" class="img-responsive" /></p>








    <div id="post-nav" class="clearfix">
        
            <a class="prev" href="/devguide_7/shells/customizing-driver-commands.html">&laquo; Commands Visibility and Usability</a>
        
        
            <a class="next" href="/devguide_7/shells/discovering-inventory-snmp.html">Discovering Inventory using SNMP &raquo;</a>
        
    </div>




<div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
        var disqus_identifier = '_shells/implementing-discovery-for-inventory-shells.md';
        var disqus_url = 'https://qualisystems.github.io/shells/implementing-discovery-for-inventory-shells.html';
        this.page.url = "https://qualisystems.github.io/devguide_7/shells/implementing-discovery-for-inventory-shells.html";  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = disqus_identifier; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
    (function() {  // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');

        s.src = '//qualidev.disqus.com/embed.js';

        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



<script src="/devguide_7/js/search.min.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript">
  $(function() {
    $('#search-query').lunrSearch({
      indexUrl  : '/devguide_7/js/index.json',           // url for the .json file containing search index data
      results   : '#search-results',          // selector for containing search results element
      template  : '#search-results-template', // selector for Mustache.js template
      titleMsg  : '',   // message attached in front of results (can be empty)
      emptyMsg  : '<p>Nothing found.</p>'     // shown message if search returns no results
    });
  });
</script>

<script>
$(function() {
    page = $(".page-header").attr("data-page-id")
    nav_item = $(".nav li[data-page-id='"+page+"']")
    if (nav_item) {
        $(".nav").find(".active").removeClass("active");
        nav_item.addClass("active");
    }
})
</script>

                    </div>
                
            </div>

            

            <div class="row">
                <div id="footer" class="col-sm-12">
                    Documentation for <a href="http://www.quali.com">CloudShell Developer Guide</a>

                </div>
            </div>
        </div>

        <script src="/devguide_7/js/prism.js"></script>

        
        <script>
 (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
 (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
 m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
 })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

 ga('create', 'UA-81468206-1', 'auto');
 ga('send', 'pageview');

</script>

        
    </body>
</html>
